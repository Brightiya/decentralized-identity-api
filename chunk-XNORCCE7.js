import{a as ge,b as _e}from"./chunk-XJVIUHWL.js";import{b as V,d as A}from"./chunk-HE6ZLVXE.js";import{a as de,c as se,d as ce,h as fe,i as ue,j as xe,k as he}from"./chunk-W4GYOFWJ.js";import{b as G,d as h,f as R,g as $,j,k as z,l as q,m as D,n as W,p as H,q as U,s as X,t as be}from"./chunk-AYDCC6QE.js";import{$ as Q,Aa as te,Ca as ie,Da as ne,Ea as oe,Fa as re,Ga as ae,Ha as le,Ia as me,Ja as pe,Ka as ve,Ma as ke,Ra as Ce,U as J,Z as K,aa as Y,ba as Z,za as ee}from"./chunk-CT4FOUKO.js";import{$a as l,Db as e,Eb as t,Fb as f,Gb as O,Hb as F,Jb as M,L as k,Mb as x,Ob as u,Pc as T,Qc as N,Sc as B,Xb as o,Xc as L,Zb as y,ec as I,ia as d,jc as P,kc as w,mb as C,na as S,sb as c,ub as m,wa as _,wb as E,xa as b}from"./chunk-ZQA5UT6E.js";function Me(r,p){r&1&&(e(0,"div",6),f(1,"mat-spinner",7),e(2,"div",8)(3,"h3"),o(4,"Waiting for wallet"),t(),e(5,"p",9),o(6,"Connect your wallet to edit your profile"),t()()())}function ye(r,p){if(r&1&&(e(0,"mat-option",30),o(1),t()),r&2){let n=p.$implicit;m("value",n.value),l(),y(" ",n.label," ")}}function Pe(r,p){if(r&1){let n=M();e(0,"div",31)(1,"mat-form-field",32)(2,"mat-label"),o(3,"Platform"),t(),f(4,"input",33),t(),e(5,"mat-form-field",34)(6,"mat-label"),o(7,"URL"),t(),f(8,"input",35),e(9,"mat-icon",36),o(10,"link"),t()(),e(11,"button",37),x("click",function(){let a=_(n).index,g=u(2);return b(g.removeLink(a))}),e(12,"mat-icon"),o(13,"delete_outline"),t()()()}if(r&2){let n=p.index;m("formGroupName",n)}}function we(r,p){r&1&&(e(0,"div",38)(1,"mat-icon",39),o(2,"link_off"),t(),e(3,"p"),o(4,"No links added yet"),t()())}function Se(r,p){r&1&&(e(0,"mat-icon"),o(1,"save"),t())}function Ee(r,p){r&1&&(e(0,"span"),o(1,"Save Profile"),t())}function Oe(r,p){r&1&&f(0,"mat-spinner",40)}function Fe(r,p){if(r&1){let n=M();O(0),e(1,"form",10),x("ngSubmit",function(){_(n);let a=u();return b(a.onSubmit())}),e(2,"div",11)(3,"mat-form-field",12)(4,"mat-label"),o(5,"Gender"),t(),e(6,"mat-select",13)(7,"mat-option",14),o(8,"Prefer not to say"),t(),c(9,ye,2,2,"mat-option",15),t(),e(10,"mat-hint"),o(11,"Optional \u2022 Private by default"),t()(),e(12,"mat-form-field",12)(13,"mat-label"),o(14,"Pronouns"),t(),f(15,"input",16),e(16,"mat-hint"),o(17,"Free text \u2022 Visible to others"),t()(),e(18,"mat-form-field",17)(19,"mat-label"),o(20,"Bio / About me"),t(),f(21,"textarea",18),e(22,"mat-hint",19),o(23),t()()(),e(24,"div",20)(25,"div",21)(26,"h3"),o(27,"Online Presence"),t(),e(28,"button",22),x("click",function(){_(n);let a=u();return b(a.addLink())}),e(29,"mat-icon"),o(30,"add"),t()()(),e(31,"div",23),c(32,Pe,14,1,"div",24),t(),c(33,we,5,0,"div",25),t(),e(34,"div",26)(35,"button",27),c(36,Se,2,0,"mat-icon",5)(37,Ee,2,0,"span",5)(38,Oe,1,0,"mat-spinner",28),t(),e(39,"button",29),x("click",function(){_(n);let a=u();return b(a.cancel())}),o(40," Cancel "),t()()(),F()}if(r&2){let n,i=u();l(),m("formGroup",i.profileForm),l(8),m("ngForOf",i.genderOptions),l(14),y(" ",((n=i.profileForm.get("bio"))==null||n.value==null?null:n.value.length)||0,"/500 "),l(9),m("ngForOf",i.onlineLinks.controls),l(),m("ngIf",i.onlineLinks.length===0),l(2),m("disabled",i.profileForm.invalid||i.saving()),l(),m("ngIf",!i.saving()),l(),m("ngIf",!i.saving()),l(),m("ngIf",i.saving())}}var lt=(()=>{class r{fb=d(U);apiService=d(be);wallet=d(ie);snackBar=d(ee);themeService=d(re);router=d(A);activatedRoute=d(V);profileForm;saving=C(!1);loading=C(!0);darkMode=this.themeService.darkMode;genderOptions=[{value:"male",label:"Male"},{value:"female",label:"Female"},{value:"non-binary",label:"Non-binary"},{value:"genderqueer",label:"Genderqueer"},{value:"transgender",label:"Transgender"},{value:"prefer-not-to-say",label:"Prefer not to say"},{value:"other",label:"Other"}];ngOnInit(){this.initForm(),this.loadCurrentProfile()}initForm(){this.profileForm=this.fb.group({gender:[""],pronouns:[""],bio:["",[h.maxLength(500)]],online_links:this.fb.array([])})}get onlineLinks(){return this.profileForm.get("online_links")}addLink(){this.onlineLinks.push(this.fb.group({platform:["",h.required],url:["",[h.required,h.pattern(/^https?:\/\/[^\s$.?#].[^\s]*$/)]]}))}removeLink(n){this.onlineLinks.removeAt(n)}loadCurrentProfile(){this.wallet.address$.pipe(k(1)).subscribe(n=>{if(!n){this.snackBar.open("No wallet connected","Close",{duration:4e3}),this.loading.set(!1);return}this.apiService.getProfile(n,"profile").subscribe({next:i=>{let a=i.attributes||{};this.profileForm.patchValue({gender:a.gender?.code||"",pronouns:a.pronouns||"",bio:a.bio||""}),i.online_links&&typeof i.online_links=="object"&&Object.entries(i.online_links).forEach(([g,s])=>{this.onlineLinks.push(this.fb.group({platform:[g],url:[s]}))}),this.loading.set(!1)},error:i=>{console.error("Failed to load profile for editing:",i),this.snackBar.open("Could not load current profile data","Close",{duration:5e3}),this.loading.set(!1)}})})}onSubmit(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched(),this.snackBar.open("Please fill required fields correctly","Close",{duration:4e3});return}this.saving.set(!0),this.wallet.address$.pipe(k(1)).subscribe(n=>{if(!n){this.saving.set(!1),this.snackBar.open("No wallet connected","Close",{duration:3e3});return}let a=this.onlineLinks.value.reduce((s,v)=>(v.platform&&v.url&&(s[v.platform.trim()]=v.url.trim()),s),{}),g={owner:n,contexts:{profile:{attributes:{gender:this.profileForm.value.gender||void 0,pronouns:this.profileForm.value.pronouns||void 0,bio:this.profileForm.value.bio||void 0},online_links:a}},credentials:[]};this.apiService.createProfile(g).subscribe({next:s=>{this.saving.set(!1),this.snackBar.open("Profile updated successfully!","Close",{duration:4e3}),this.router.navigate(["../overview"],{relativeTo:this.activatedRoute})},error:s=>{console.error("Profile update failed:",s),this.saving.set(!1),this.snackBar.open("Failed to update profile. Try again.","Close",{duration:6e3})}})})}cancel(){this.router.navigate(["../overview"],{relativeTo:this.activatedRoute})}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=S({type:r,selectors:[["app-profile-edit"]],standalone:!0,features:[I],decls:12,vars:8,consts:[[1,"edit-profile-container"],[1,"page-header"],[1,"subtitle"],["appearance","outlined",1,"edit-card","glass-card"],["class","connection-state",4,"ngIf"],[4,"ngIf"],[1,"connection-state"],["diameter","48"],[1,"state-message"],[1,"muted"],[1,"profile-edit-form",3,"ngSubmit","formGroup"],[1,"form-grid"],["appearance","outline",1,"form-field"],["formControlName","gender"],["value",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","pronouns","placeholder","they/them, she/her, he/him, ze/zir..."],["appearance","outline",1,"form-field","full-width"],["matInput","","formControlName","bio","rows","5","maxlength","500","placeholder","Share a bit about yourself, your interests, or what you do..."],["align","end"],[1,"links-section"],[1,"section-header"],["mat-mini-fab","","color","primary","type","button","matTooltip","Add new link","aria-label","Add link",3,"click"],["formArrayName","online_links",1,"links-container"],["class","link-item glass-item",3,"formGroupName",4,"ngFor","ngForOf"],["class","empty-links",4,"ngIf"],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",1,"save-btn",3,"disabled"],["diameter","20",4,"ngIf"],["mat-stroked-button","","type","button",3,"click"],[3,"value"],[1,"link-item","glass-item",3,"formGroupName"],["appearance","outline",1,"platform"],["matInput","","formControlName","platform","placeholder","Twitter / X, GitHub, LinkedIn, Website..."],["appearance","outline",1,"url"],["matInput","","formControlName","url","placeholder","https://twitter.com/yourhandle"],["matPrefix",""],["mat-icon-button","","color","warn","type","button","matTooltip","Remove this link",3,"click"],[1,"empty-links"],[1,"empty-icon"],["diameter","20"]],template:function(i,a){i&1&&(e(0,"div",0)(1,"div",1)(2,"h1"),o(3,"Edit Profile"),t(),e(4,"p",2),o(5,"Update how others see you in the ecosystem"),t()(),e(6,"mat-card",3)(7,"mat-card-content"),c(8,Me,7,0,"div",4),P(9,"async"),c(10,Fe,41,9,"ng-container",5),P(11,"async"),t()()()),i&2&&(E("dark",a.darkMode()),l(8),m("ngIf",!w(9,4,a.wallet.address$)),l(2),m("ngIf",w(11,6,a.wallet.address$)))},dependencies:[L,T,N,B,X,j,G,R,$,H,z,W,q,D,Ce,ve,ke,ue,fe,de,se,ce,_e,ge,he,xe,J,Z,K,Y,Q,oe,ne,pe,me,te,le,ae],styles:["[_nghost-%COMP%]{display:block}.edit-profile-container[_ngcontent-%COMP%]{padding:clamp(24px,4vw,48px) clamp(16px,5vw,64px);max-width:900px;margin:0 auto;transition:background .5s ease}.edit-profile-container.dark[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#0f0f1a,#0a0a14);color:#e2e8f0}.page-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:clamp(32px,5vw,56px)}.page-header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:clamp(2.2rem,5vw,3.2rem);font-weight:800;background:linear-gradient(135deg,#6366f1,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:0 0 8px}.subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:#94a3b8;font-weight:400}.edit-card[_ngcontent-%COMP%]{border-radius:24px;background:var(--card-bg, rgba(255, 255, 255, .78));-webkit-backdrop-filter:blur(16px) saturate(180%);backdrop-filter:blur(16px) saturate(180%);border:1px solid var(--card-border, rgba(226, 232, 240, .4));overflow:hidden;transition:all .4s ease}.edit-profile-container.dark[_ngcontent-%COMP%]   .edit-card[_ngcontent-%COMP%]{background:#1e293b7a;border-color:#64748b4d;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}.connection-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:420px;gap:24px;color:#94a3b8;text-align:center}.state-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--text-primary)}.profile-edit-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:32px;padding:24px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}.form-field.full-width[_ngcontent-%COMP%]{grid-column:1/-1}@media (max-width: 720px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.section-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.section-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:600;color:var(--text-primary)}.links-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.link-item[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;padding:16px;border-radius:16px;background:var(--row-bg, rgba(0, 0, 0, .03));transition:all .25s ease}.edit-profile-container.dark[_ngcontent-%COMP%]   .link-item[_ngcontent-%COMP%]{background:#ffffff0d}.link-item[_ngcontent-%COMP%]:hover{background:var(--row-hover, rgba(99, 102, 241, .08))}.platform[_ngcontent-%COMP%]{flex:1 1 180px;min-width:140px}.url[_ngcontent-%COMP%]{flex:3 1 340px;min-width:240px}.empty-links[_ngcontent-%COMP%]{text-align:center;padding:48px 24px;color:#94a3b8;background:var(--row-bg, rgba(0, 0, 0, .02));border-radius:16px}.empty-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:12px;opacity:.7}.form-actions[_ngcontent-%COMP%]{display:flex;gap:16px;justify-content:flex-end;margin-top:24px;padding-top:24px;border-top:1px solid var(--divider, rgba(226, 232, 240, .3))}.save-btn[_ngcontent-%COMP%]{min-width:160px}@media (max-width: 480px){.form-actions[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.save-btn[_ngcontent-%COMP%]{width:100%}}"]})}return r})();export{lt as ProfileEditComponent};
